# Docker Compose for MCP Servers
# Model Context Protocol servers for AI assistant integration
#
# Usage (from project root):
#   docker-compose -f docker/docker-compose.mcp.yml up -d
#   docker-compose -f docker/docker-compose.mcp.yml logs -f
#   docker-compose -f docker/docker-compose.mcp.yml down

version: '3.8'

services:
  # PostgreSQL Database (for MCP postgres server)
  postgres:
    image: postgres:15-alpine
    container_name: mcp_postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mcp_user}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-mcp_password}
      POSTGRES_DB: ${POSTGRES_DB:-mcp_db}
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-mcp_user}"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mcp-network

  # SQLite data directory (for MCP sqlite server)
  sqlite-data:
    image: alpine:latest
    container_name: mcp_sqlite_data
    volumes:
      - sqlite_data:/data
    command: sh -c "chmod 777 /data && tail -f /dev/null"
    networks:
      - mcp-network

# Example: MCP Filesystem Server
# Uncomment and configure based on your needs
# mcp-filesystem:
#   build:
#     context: ./mcp-servers/filesystem
#     dockerfile: Dockerfile
#   container_name: mcp_filesystem
#   restart: unless-stopped
#   volumes:
#     - ./:/workspace:ro  # Read-only access to project
#   environment:
#     - MCP_PORT=3001
#     - WORKSPACE_PATH=/workspace
#   networks:
#     - mcp-network
#   healthcheck:
#     test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3001/health"]
#     interval: 30s
#     timeout: 10s
#     retries: 3

# Example: MCP SQLite Server
# mcp-sqlite:
#   build:
#     context: ./mcp-servers/sqlite
#     dockerfile: Dockerfile
#   container_name: mcp_sqlite
#   restart: unless-stopped
#   volumes:
#     - sqlite_data:/data:ro  # SQLite database files
#   environment:
#     - MCP_PORT=3002
#     - SQLITE_PATH=/data
#   depends_on:
#     - sqlite-data
#   networks:
#     - mcp-network

# Example: MCP PostgreSQL Server
# mcp-postgres:
#   build:
#     context: ./mcp-servers/postgres
#     dockerfile: Dockerfile
#   container_name: mcp_postgres_server
#   restart: unless-stopped
#   environment:
#     - MCP_PORT=3003
#     - POSTGRES_HOST=postgres
#     - POSTGRES_PORT=5432
#     - POSTGRES_USER=${POSTGRES_USER:-mcp_user}
#     - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-mcp_password}
#     - POSTGRES_DB=${POSTGRES_DB:-mcp_db}
#   depends_on:
#     postgres:
#       condition: service_healthy
#   networks:
#     - mcp-network

networks:
  mcp-network:
    driver: bridge
    name: mcp-network

volumes:
  postgres_data:
    driver: local
    name: mcp_postgres_data
  sqlite_data:
    driver: local
    name: mcp_sqlite_data

