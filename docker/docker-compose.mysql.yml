# Docker Compose Configuration for Bob's Garage Development Environment
#
# This setup provides a MySQL database container for local development.
# For non-Docker MySQL setup, see docs/MYSQL_SETUP_GUIDE.md
#
# Usage (from server directory):
#   docker-compose -f ../docker/docker-compose.mysql.yml up -d        # Start database
#   docker-compose -f ../docker/docker-compose.mysql.yml down         # Stop database
#   docker-compose -f ../docker/docker-compose.mysql.yml logs -f      # View logs
#   docker-compose -f ../docker/docker-compose.mysql.yml down -v      # Stop and remove data
#
# Usage (from project root):
#   docker-compose -f docker/docker-compose.mysql.yml --env-file server/.env up -d

version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: bobs_garage_mysql
    restart: unless-stopped
    
    environment:
      # Database configuration - Uses values from .env file
      MYSQL_ROOT_PASSWORD: ${DATABASE_PASSWORD}
      MYSQL_DATABASE: ${DATABASE_NAME}
      MYSQL_USER: ${DATABASE_USER}
      MYSQL_PASSWORD: ${DATABASE_PASSWORD}
      TZ: ${TZ:-UTC}
    
    ports:
      # Map host port to container port
      # Format: "HOST_PORT:CONTAINER_PORT"
      - "${DATABASE_PORT}:3306"
    
    volumes:
      # Persistent data storage
      - mysql_data:/var/lib/mysql
      
    command: >
      --default-authentication-plugin=mysql_native_password
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
      --max-connections=200
      --innodb-buffer-pool-size=1G
    
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p${DATABASE_PASSWORD}"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    
    networks:
      - bobs_garage_network

networks:
  bobs_garage_network:
    driver: bridge

volumes:
  mysql_data:
    driver: local
    name: bobs_garage_mysql_data
